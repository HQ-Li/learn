<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>35-ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼šå¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹ï¼Ÿ</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
        html {
            color: #333;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-rendering: optimizelegibility;
            font-family: Helvetica Neue, PingFang SC, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif
        }

        html.borderbox *,
        html.borderbox :after,
        html.borderbox :before {
            box-sizing: border-box
        }

        article,
        aside,
        blockquote,
        body,
        button,
        code,
        dd,
        details,
        dl,
        dt,
        fieldset,
        figcaption,
        figure,
        footer,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        header,
        hr,
        input,
        legend,
        li,
        menu,
        nav,
        ol,
        p,
        pre,
        section,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        menu,
        nav,
        section {
            display: block
        }

        audio,
        canvas,
        video {
            display: inline-block
        }

        body,
        button,
        input,
        select,
        textarea {
            font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, Helvetica, sans-serif
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        blockquote {
            position: relative;
            color: #999;
            font-weight: 400;
            border-left: 1px solid #1abc9c;
            padding-left: 1em;
            margin: 1em 3em 1em 2em
        }

        @media only screen and (max-width: 640px) {
            blockquote {
                margin: 1em 0
            }
        }

        abbr,
        acronym {
            border-bottom: 1px dotted;
            font-variant: normal
        }

        abbr {
            cursor: help
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 400
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        q:after,
        q:before {
            content: ""
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative
        }

        :root sub,
        :root sup {
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a {
            color: #1abc9c
        }

        a:hover {
            text-decoration: underline
        }

        .typo a {
            border-bottom: 1px solid #1abc9c
        }

        .typo a:hover {
            border-bottom-color: #555;
            color: #555
        }

        .typo a:hover,
        a,
        ins {
            text-decoration: none
        }

        .typo-u,
        u {
            text-decoration: underline
        }

        mark {
            background: #fffdd1;
            border-bottom: 1px solid #ffedce;
            padding: 2px;
            margin: 0 5px
        }

        code,
        pre,
        pre tt {
            font-family: Courier, Courier New, monospace
        }

        pre {
            background: hsla(0, 0%, 97%, .7);
            border: 1px solid #ddd;
            padding: 1em 1.5em;
            display: block;
            -webkit-overflow-scrolling: touch
        }

        hr {
            border: none;
            border-bottom: 1px solid #cfcfcf;
            margin-bottom: .8em;
            height: 10px
        }

        .typo-small,
        figcaption,
        small {
            font-size: .9em;
            color: #888
        }

        b,
        strong {
            font-weight: 700;
            color: #000
        }

        [draggable] {
            cursor: move
        }

        .clearfix:after,
        .clearfix:before {
            content: "";
            display: table
        }

        .clearfix:after {
            clear: both
        }

        .clearfix {
            zoom: 1
        }

        .textwrap,
        .textwrap td,
        .textwrap th {
            word-wrap: break-word;
            word-break: break-all
        }

        .textwrap-table {
            table-layout: fixed
        }

        .serif {
            font-family: Palatino, Optima, Georgia, serif
        }

        .typo-dl,
        .typo-form,
        .typo-hr,
        .typo-ol,
        .typo-p,
        .typo-pre,
        .typo-table,
        .typo-ul,
        .typo dl,
        .typo form,
        .typo hr,
        .typo ol,
        .typo p,
        .typo pre,
        .typo table,
        .typo ul,
        blockquote {
            margin-bottom: 1rem
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: PingFang SC, Helvetica Neue, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;
            color: #000;
            line-height: 1.35
        }

        .typo-h1,
        .typo-h2,
        .typo-h3,
        .typo-h4,
        .typo-h5,
        .typo-h6,
        .typo h1,
        .typo h2,
        .typo h3,
        .typo h4,
        .typo h5,
        .typo h6 {
            margin-top: 1.2em;
            margin-bottom: .6em;
            line-height: 1.35
        }

        .typo-h1,
        .typo h1 {
            font-size: 2em
        }

        .typo-h2,
        .typo h2 {
            font-size: 1.8em
        }

        .typo-h3,
        .typo h3 {
            font-size: 1.6em
        }

        .typo-h4,
        .typo h4 {
            font-size: 1.4em
        }

        .typo-h5,
        .typo-h6,
        .typo h5,
        .typo h6 {
            font-size: 1.2em
        }

        .typo-ul,
        .typo ul {
            margin-left: 1.3em;
            list-style: disc
        }

        .typo-ol,
        .typo ol {
            list-style: decimal;
            margin-left: 1.9em
        }

        .typo-ol ol,
        .typo-ol ul,
        .typo-ul ol,
        .typo-ul ul,
        .typo li ol,
        .typo li ul {
            margin-bottom: .8em;
            margin-left: 2em
        }

        .typo-ol ul,
        .typo-ul ul,
        .typo li ul {
            list-style: circle
        }

        .typo-table td,
        .typo-table th,
        .typo table caption,
        .typo table td,
        .typo table th {
            border: 1px solid #ddd;
            padding: .5em 1em;
            color: #666
        }

        .typo-table th,
        .typo table th {
            background: #fbfbfb
        }

        .typo-table thead th,
        .typo table thead th {
            background: hsla(0, 0%, 95%, .7)
        }

        .typo table caption {
            border-bottom: none
        }

        .typo-input,
        .typo-textarea {
            -webkit-appearance: none;
            border-radius: 0
        }

        .typo-em,
        .typo em,
        caption,
        legend {
            color: #000;
            font-weight: inherit
        }

        .typo-em {
            position: relative
        }

        .typo-em:after {
            position: absolute;
            top: .65em;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"
        }

        .typo img {
            max-width: 100%
        }

        .common-content {
            font-weight: 400;
            color: #353535;
            line-height: 1.75rem;
            white-space: normal;
            word-break: normal;
            font-size: 1rem
        }

        .common-content img {
            display: block;
            max-width: 100%;
            background-color: #eee
        }

        .common-content audio,
        .common-content video {
            width: 100%;
            background-color: #eee
        }

        .common-content center,
        .common-content font {
            margin-top: 1rem;
            display: inline-block
        }

        .common-content center {
            width: 100%
        }

        .common-content pre {
            margin-top: 1rem;
            padding-left: 0;
            padding-right: 0;
            position: relative;
            overflow: hidden
        }

        .common-content pre code {
            font-size: .8rem;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            width: 100%;
            box-sizing: border-box;
            padding-left: 1rem;
            padding-right: 1rem;
            overflow-x: auto
        }

        .common-content hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        .common-content b,
        .common-content h1,
        .common-content h2,
        .common-content h3,
        .common-content h4,
        .common-content h5,
        .common-content strong {
            font-weight: 700
        }

        .common-content h1,
        .common-content h2 {
            font-size: 1.125rem;
            margin-bottom: .45rem
        }

        .common-content h3,
        .common-content h4,
        .common-content h5 {
            font-size: 1rem;
            margin-bottom: .45rem
        }

        .common-content p {
            font-weight: 400;
            color: #353535;
            margin-top: .15rem
        }

        .common-content .orange {
            color: #ff5a05
        }

        .common-content .reference {
            font-size: 1rem;
            color: #888
        }

        .custom-rich-content h1 {
            margin-top: 0;
            font-weight: 400;
            font-size: 15.25px;
            border-bottom: 1px solid #eee;
            line-height: 2.8
        }

        .custom-rich-content li,
        .custom-rich-content p {
            font-size: 14px;
            color: #888;
            line-height: 1.6
        }

        table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        table.hljs-ln,
        table.hljs-ln tbody,
        table.hljs-ln td,
        table.hljs-ln tr {
            box-sizing: border-box
        }

        table.hljs-ln td {
            padding: 0;
            border: 0
        }

        table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            user-select: none
        }

        table.hljs-ln td.hljs-ln-code,
        table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            font-size: 12px;
            line-height: 20px;
            vertical-align: top
        }

        table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            color: #24292e;
            word-wrap: normal;
            white-space: pre
        }

        video::-webkit-media-controls {
            overflow: hidden !important
        }

        video::-webkit-media-controls-enclosure {
            width: calc(100% + 32px);
            margin-left: auto
        }

        ._29HP61GA_0 {
            max-width:800px;
            margin:0 auto;
            margin-bottom: 20px;
            font-weight: 400;
            color: #353535;
            line-height: 1.76;
            white-space: normal;
            word-break: normal;
            font-size: 17px;
            -webkit-transition: background-color .3s ease;
            transition: background-color .3s ease
        }

        ._29HP61GA_0 .MathJax_Display {
            overflow: auto
        }

        ._29HP61GA_0 .poster {
            position: fixed;
            left: -10000px;
            top: -10000px;
            overflow: hidden;
            padding: 1rem;
            background: #ececec
        }

        ._29HP61GA_0 .richcontent-pre-copy {
            font-size: 13px;
            color: #888;
            position: absolute;
            right: 1em;
            top: .5em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 .richcontent-pre-copy .iconfont {
            font-size: 12px;
            margin-right: .2em
        }

        ._29HP61GA_0 a {
            color: #fa8919;
            border-bottom: 1px solid #fa8919
        }

        ._29HP61GA_0 img {
            display: block;
            max-width: 100%;
            position: relative;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            background-color: #eee;
            vertical-align: top;
            border-radius: 0
        }

        ._29HP61GA_0 audio,
        ._29HP61GA_0 video {
            width: 100%;
            background-color: #eee
        }

        ._29HP61GA_0 pre {
            margin-top: 16px;
            padding: 34px 0 0;
            margin-bottom: 30px;
            position: relative;
            border-radius: 6px;
            background: rgba(246, 247, 251, .749);
            border: 0
        }

        ._29HP61GA_0 pre code {
            font-size: 12px;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 16px;
            margin-right: 16px;
            overflow-x: scroll
        }

        ._29HP61GA_0 pre code:after {
            content: "";
            height: 30px;
            width: 100%;
            display: block
        }

        ._29HP61GA_0 hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        ._29HP61GA_0 h1,
        ._29HP61GA_0 h2,
        ._29HP61GA_0 h3,
        ._29HP61GA_0 h4,
        ._29HP61GA_0 h5 {
            margin-bottom: 20px;
            margin-top: 0;
            font-weight: 700
        }

        ._29HP61GA_0 b,
        ._29HP61GA_0 strong {
            font-weight: 700
        }

        ._29HP61GA_0 h1 {
            font-size: 21px
        }

        ._29HP61GA_0 h2 {
            font-size: 20px
        }

        ._29HP61GA_0 h3 {
            font-size: 19px
        }

        ._29HP61GA_0 h4 {
            font-size: 18px
        }

        ._29HP61GA_0 h5 {
            font-size: 17px
        }

        ._29HP61GA_0 center,
        ._29HP61GA_0 p {
            font-weight: 400;
            color: #353535;
            margin-top: 0;
            margin-bottom: 30px;
            word-break: break-word
        }

        ._29HP61GA_0 center {
            text-align: center
        }

        ._29HP61GA_0 blockquote {
            margin-top: 0;
            margin-bottom: 34px;
            border-left: 3px solid #e8e8e8;
            padding-left: 17px;
            color: #353535
        }

        ._29HP61GA_0 blockquote p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol,
        ._29HP61GA_0 ul {
            margin-bottom: 30px
        }

        ._29HP61GA_0 ol p,
        ._29HP61GA_0 ul p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol {
            list-style: decimal;
            margin-left: 20px
        }

        ._29HP61GA_0 ul li {
            padding-left: 17px;
            position: relative;
            margin-bottom: 10px
        }

        ._29HP61GA_0 ul li:after {
            content: "";
            height: 6px;
            width: 6px;
            border-radius: 50%;
            background: #353535;
            position: absolute;
            top: 10px;
            left: 0
        }

        ._29HP61GA_0 .orange {
            color: #fa8919
        }

        ._29HP61GA_0 .reference {
            color: #888
        }

        ._29HP61GA_0 .m-right {
            text-align: right
        }

        ._29HP61GA_0 .m-center {
            text-align: center;
            display: block
        }

        ._29HP61GA_0 .m-gray {
            color: #888
        }

        ._29HP61GA_0 .m-small {
            font-size: 15px
        }

        ._29HP61GA_0 table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        ._29HP61GA_0 table.hljs-ln,
        ._29HP61GA_0 table.hljs-ln tbody,
        ._29HP61GA_0 table.hljs-ln td,
        ._29HP61GA_0 table.hljs-ln tr {
            -webkit-box-sizing: border-box;
            box-sizing: border-box
        }

        ._29HP61GA_0 table.hljs-ln td {
            padding: 0;
            border: 0
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            font-size: 12px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code,
        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            line-height: 20px;
            vertical-align: top
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            font-size: 13px;
            color: #666;
            word-wrap: normal;
            white-space: pre
        }

    </style>
</head>
<body>
<div class="_29HP61GA_0">
<h1>35-ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼šå¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹ï¼Ÿ</h1>
<p>å‰é¢ä¸¤ç¯‡æ–‡ç« æˆ‘ä»¬è®²è¿°çš„å†…å®¹ï¼Œä»çº¯æŠ€æœ¯çš„è§’åº¦çœ‹ï¼Œéƒ½æ˜¯<strong>å¯åŠ¨</strong>å¤šçº¿ç¨‹å»æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚æ—¢å¯åŠ¨ï¼Œé‚£åˆè¯¥å¦‚ä½•ç»ˆæ­¢å‘¢ï¼Ÿä»Šå¤©å’±ä»¬å°±ä»æŠ€æœ¯çš„è§’åº¦èŠèŠå¦‚ä½•ä¼˜é›…åœ°<strong>ç»ˆæ­¢</strong>çº¿ç¨‹ï¼Œæ­£æ‰€è°“æœ‰å§‹æœ‰ç»ˆã€‚</p><p>åœ¨<a href="https://time.geekbang.org/column/article/86366">ã€Š09 | Javaçº¿ç¨‹ï¼ˆä¸Šï¼‰ï¼šJavaçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‹</a>ä¸­ï¼Œæˆ‘æ›¾è®²è¿‡ï¼šçº¿ç¨‹æ‰§è¡Œå®Œæˆ–è€…å‡ºç°å¼‚å¸¸å°±ä¼šè¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚è¿™æ ·çœ‹ï¼Œç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹çœ‹ä¸Šå»å¾ˆç®€å•å•Šï¼ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œè‡ªå·±çš„ä»»åŠ¡ï¼Œè‡ªå·±è¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼Œè¿™çš„ç¡®å¾ˆç®€å•ã€‚ä¸è¿‡æˆ‘ä»¬ä»Šå¤©è°ˆåˆ°çš„â€œä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹â€ï¼Œä¸æ˜¯è‡ªå·±ç»ˆæ­¢è‡ªå·±ï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹T1ä¸­ï¼Œç»ˆæ­¢çº¿ç¨‹T2ï¼›è¿™é‡Œæ‰€è°“çš„â€œä¼˜é›…â€ï¼ŒæŒ‡çš„æ˜¯ç»™T2ä¸€ä¸ªæœºä¼šæ–™ç†åäº‹ï¼Œè€Œä¸æ˜¯è¢«ä¸€å‰‘å°å–‰ã€‚</p><p>Javaè¯­è¨€çš„Threadç±»ä¸­æ›¾ç»æä¾›äº†ä¸€ä¸ªstop()æ–¹æ³•ï¼Œç”¨æ¥ç»ˆæ­¢çº¿ç¨‹ï¼Œå¯æ˜¯æ—©å·²ä¸å»ºè®®ä½¿ç”¨äº†ï¼ŒåŸå› æ˜¯è¿™ä¸ªæ–¹æ³•ç”¨çš„å°±æ˜¯ä¸€å‰‘å°å–‰çš„åšæ³•ï¼Œè¢«ç»ˆæ­¢çš„çº¿ç¨‹æ²¡æœ‰æœºä¼šæ–™ç†åäº‹ã€‚</p><p>æ—¢ç„¶ä¸å»ºè®®ä½¿ç”¨stop()æ–¹æ³•ï¼Œé‚£åœ¨Javaé¢†åŸŸï¼Œæˆ‘ä»¬åˆè¯¥å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹å‘¢ï¼Ÿ</p><h2>å¦‚ä½•ç†è§£ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼</h2><p>å‰è¾ˆä»¬ç»è¿‡è®¤çœŸå¯¹æ¯”åˆ†æï¼Œå·²ç»æ€»ç»“å‡ºäº†ä¸€å¥—æˆç†Ÿçš„æ–¹æ¡ˆï¼Œå«åš<strong>ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼</strong>ã€‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†ç»ˆæ­¢è¿‡ç¨‹åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªé˜¶æ®µä¸»è¦æ˜¯çº¿ç¨‹T1å‘çº¿ç¨‹T2<strong>å‘é€ç»ˆæ­¢æŒ‡ä»¤</strong>ï¼Œè€Œç¬¬äºŒé˜¶æ®µåˆ™æ˜¯çº¿ç¨‹T2<strong>å“åº”ç»ˆæ­¢æŒ‡ä»¤</strong>ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/a5/5c/a5ea3cb2106f11ef065702f34703645c.png" alt=""></p><center><span class="reference">ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ç¤ºæ„å›¾</span></center><!-- [[[read_end]]] --><p>é‚£åœ¨Javaè¯­è¨€é‡Œï¼Œç»ˆæ­¢æŒ‡ä»¤æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªè¦ä»Javaçº¿ç¨‹çš„çŠ¶æ€è½¬æ¢è¿‡ç¨‹è¯´èµ·ã€‚æˆ‘ä»¬åœ¨<a href="https://time.geekbang.org/column/article/86366">ã€Š09 | Javaçº¿ç¨‹ï¼ˆä¸Šï¼‰ï¼šJavaçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‹</a>ä¸­æ›¾ç»æåˆ°è¿‡Javaçº¿ç¨‹çš„çŠ¶æ€è½¬æ¢å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://static001.geekbang.org/resource/image/3f/8c/3f6c6bf95a6e8627bdf3cb621bbb7f8c.png" alt=""></p><center><span class="reference">Javaä¸­çš„çº¿ç¨‹çŠ¶æ€è½¬æ¢å›¾</span></center><p>ä»è¿™ä¸ªå›¾é‡Œä½ ä¼šå‘ç°ï¼ŒJavaçº¿ç¨‹è¿›å…¥ç»ˆæ­¢çŠ¶æ€çš„å‰ææ˜¯çº¿ç¨‹è¿›å…¥RUNNABLEçŠ¶æ€ï¼Œè€Œå®é™…ä¸Šçº¿ç¨‹ä¹Ÿå¯èƒ½å¤„åœ¨ä¼‘çœ çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¦æƒ³ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Œé¦–å…ˆè¦æŠŠçº¿ç¨‹çš„çŠ¶æ€ä»ä¼‘çœ çŠ¶æ€è½¬æ¢åˆ°RUNNABLEçŠ¶æ€ã€‚å¦‚ä½•åšåˆ°å‘¢ï¼Ÿè¿™ä¸ªè¦é Java Threadç±»æä¾›çš„<strong>interrupt()æ–¹æ³•</strong>ï¼Œå®ƒå¯ä»¥å°†ä¼‘çœ çŠ¶æ€çš„çº¿ç¨‹è½¬æ¢åˆ°RUNNABLEçŠ¶æ€ã€‚</p><p>çº¿ç¨‹è½¬æ¢åˆ°RUNNABLEçŠ¶æ€ä¹‹åï¼Œæˆ‘ä»¬å¦‚ä½•å†å°†å…¶ç»ˆæ­¢å‘¢ï¼ŸRUNNABLEçŠ¶æ€è½¬æ¢åˆ°ç»ˆæ­¢çŠ¶æ€ï¼Œä¼˜é›…çš„æ–¹å¼æ˜¯è®©Javaçº¿ç¨‹è‡ªå·±æ‰§è¡Œå®Œ run() æ–¹æ³•ï¼Œæ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬é‡‡ç”¨çš„æ–¹æ³•æ˜¯<strong>è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½</strong>ï¼Œç„¶åçº¿ç¨‹ä¼šåœ¨åˆé€‚çš„æ—¶æœºæ£€æŸ¥è¿™ä¸ªæ ‡å¿—ä½ï¼Œå¦‚æœå‘ç°ç¬¦åˆç»ˆæ­¢æ¡ä»¶ï¼Œåˆ™è‡ªåŠ¨é€€å‡ºrun()æ–¹æ³•ã€‚è¿™ä¸ªè¿‡ç¨‹å…¶å®å°±æ˜¯æˆ‘ä»¬å‰é¢æåˆ°çš„ç¬¬äºŒé˜¶æ®µï¼š<strong>å“åº”ç»ˆæ­¢æŒ‡ä»¤</strong>ã€‚</p><p>ç»¼åˆä¸Šé¢è¿™ä¸¤ç‚¹ï¼Œæˆ‘ä»¬èƒ½æ€»ç»“å‡ºç»ˆæ­¢æŒ‡ä»¤ï¼Œå…¶å®åŒ…æ‹¬ä¸¤æ–¹é¢å†…å®¹ï¼š<strong>interrupt()æ–¹æ³•</strong>å’Œ<strong>çº¿ç¨‹ç»ˆæ­¢çš„æ ‡å¿—ä½</strong>ã€‚</p><p>ç†è§£äº†ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ä¹‹åï¼Œä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸ªå®é™…å·¥ä½œä¸­çš„æ¡ˆä¾‹ã€‚</p><h2>ç”¨ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ç»ˆæ­¢ç›‘æ§æ“ä½œ</h2><p>å®é™…å·¥ä½œä¸­ï¼Œæœ‰äº›ç›‘æ§ç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°é‡‡é›†ä¸€äº›æ•°æ®ï¼Œä¸€èˆ¬éƒ½æ˜¯ç›‘æ§ç³»ç»Ÿå‘é€é‡‡é›†æŒ‡ä»¤ç»™è¢«ç›‘æ§ç³»ç»Ÿçš„ç›‘æ§ä»£ç†ï¼Œç›‘æ§ä»£ç†æ¥æ”¶åˆ°æŒ‡ä»¤ä¹‹åï¼Œä»ç›‘æ§ç›®æ ‡æ”¶é›†æ•°æ®ï¼Œç„¶åå›ä¼ ç»™ç›‘æ§ç³»ç»Ÿï¼Œè¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å‡ºäºå¯¹æ€§èƒ½çš„è€ƒè™‘ï¼ˆæœ‰äº›ç›‘æ§é¡¹å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“å¾ˆå¤§ï¼Œæ‰€ä»¥ä¸èƒ½ä¸€ç›´æŒç»­ç›‘æ§ï¼‰ï¼ŒåŠ¨æ€é‡‡é›†åŠŸèƒ½ä¸€èˆ¬éƒ½ä¼šæœ‰ç»ˆæ­¢æ“ä½œã€‚</p><p><img src="https://static001.geekbang.org/resource/image/11/5f/11e3b0a4a9cf743124091b22e10d275f.png" alt=""></p><center><span class="reference">åŠ¨æ€é‡‡é›†åŠŸèƒ½ç¤ºæ„å›¾</span></center><p>ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯<strong>ç›‘æ§ä»£ç†</strong>ç®€åŒ–ä¹‹åçš„å®ç°ï¼Œstart()æ–¹æ³•ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹rptThreadæ¥æ‰§è¡Œç›‘æ§æ•°æ®é‡‡é›†å’Œå›ä¼ çš„åŠŸèƒ½ï¼Œstop()æ–¹æ³•éœ€è¦ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹rptThreadï¼Œé‚£stop()ç›¸å…³åŠŸèƒ½è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p><pre><code>class Proxy {
  boolean started = false;
  //é‡‡é›†çº¿ç¨‹
  Thread rptThread;
  //å¯åŠ¨é‡‡é›†åŠŸèƒ½
  synchronized void start(){
    //ä¸å…è®¸åŒæ—¶å¯åŠ¨å¤šä¸ªé‡‡é›†çº¿ç¨‹
    if (started) {
      return;
    }
    started = true;
    rptThread = new Thread(()-&gt;{
      while (true) {
        //çœç•¥é‡‡é›†ã€å›ä¼ å®ç°
        report();
        //æ¯éš”ä¸¤ç§’é’Ÿé‡‡é›†ã€å›ä¼ ä¸€æ¬¡æ•°æ®
        try {
          Thread.sleep(2000);
        } catch (InterruptedException e) {  
        }
      }
      //æ‰§è¡Œåˆ°æ­¤å¤„è¯´æ˜çº¿ç¨‹é©¬ä¸Šç»ˆæ­¢
      started = false;
    });
    rptThread.start();
  }
  //ç»ˆæ­¢é‡‡é›†åŠŸèƒ½
  synchronized void stop(){
    //å¦‚ä½•å®ç°ï¼Ÿ
  }
}  
</code></pre><p>æŒ‰ç…§ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åšçš„å°±æ˜¯å°†çº¿ç¨‹rptThreadçŠ¶æ€è½¬æ¢åˆ°RUNNABLEï¼Œåšæ³•å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨è°ƒç”¨ <code>rptThread.interrupt()</code> å°±å¯ä»¥äº†ã€‚çº¿ç¨‹rptThreadçš„çŠ¶æ€è½¬æ¢åˆ°RUNNABLEä¹‹åï¼Œå¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢å‘¢ï¼Ÿä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©çš„æ ‡å¿—ä½æ˜¯çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼š<code>Thread.currentThread().isInterrupted()</code> ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨æ•è·Thread.sleep()çš„ä¸­æ–­å¼‚å¸¸ä¹‹åï¼Œé€šè¿‡ <code>Thread.currentThread().interrupt()</code> é‡æ–°è®¾ç½®äº†çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œå› ä¸ºJVMçš„å¼‚å¸¸å¤„ç†ä¼šæ¸…é™¤çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ã€‚</p><pre><code>class Proxy {
  boolean started = false;
  //é‡‡é›†çº¿ç¨‹
  Thread rptThread;
  //å¯åŠ¨é‡‡é›†åŠŸèƒ½
  synchronized void start(){
    //ä¸å…è®¸åŒæ—¶å¯åŠ¨å¤šä¸ªé‡‡é›†çº¿ç¨‹
    if (started) {
      return;
    }
    started = true;
    rptThread = new Thread(()-&gt;{
      while (!Thread.currentThread().isInterrupted()){
        //çœç•¥é‡‡é›†ã€å›ä¼ å®ç°
        report();
        //æ¯éš”ä¸¤ç§’é’Ÿé‡‡é›†ã€å›ä¼ ä¸€æ¬¡æ•°æ®
        try {
          Thread.sleep(2000);
        } catch (InterruptedException e){
          //é‡æ–°è®¾ç½®çº¿ç¨‹ä¸­æ–­çŠ¶æ€
          Thread.currentThread().interrupt();
        }
      }
      //æ‰§è¡Œåˆ°æ­¤å¤„è¯´æ˜çº¿ç¨‹é©¬ä¸Šç»ˆæ­¢
      started = false;
    });
    rptThread.start();
  }
  //ç»ˆæ­¢é‡‡é›†åŠŸèƒ½
  synchronized void stop(){
    rptThread.interrupt();
  }
}
</code></pre><p>ä¸Šé¢çš„ç¤ºä¾‹ä»£ç çš„ç¡®èƒ½å¤Ÿè§£å†³å½“å‰çš„é—®é¢˜ï¼Œä½†æ˜¯å»ºè®®ä½ åœ¨å®é™…å·¥ä½œä¸­è°¨æ…ä½¿ç”¨ã€‚åŸå› åœ¨äºæˆ‘ä»¬å¾ˆå¯èƒ½åœ¨çº¿ç¨‹çš„run()æ–¹æ³•ä¸­è°ƒç”¨ç¬¬ä¸‰æ–¹ç±»åº“æä¾›çš„æ–¹æ³•ï¼Œè€Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•ä¿è¯ç¬¬ä¸‰æ–¹ç±»åº“æ­£ç¡®å¤„ç†äº†çº¿ç¨‹çš„ä¸­æ–­å¼‚å¸¸ï¼Œä¾‹å¦‚ç¬¬ä¸‰æ–¹ç±»åº“åœ¨æ•è·åˆ°Thread.sleep()æ–¹æ³•æŠ›å‡ºçš„ä¸­æ–­å¼‚å¸¸åï¼Œæ²¡æœ‰é‡æ–°è®¾ç½®çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´çº¿ç¨‹ä¸èƒ½å¤Ÿæ­£å¸¸ç»ˆæ­¢ã€‚æ‰€ä»¥å¼ºçƒˆå»ºè®®ä½ <strong>è®¾ç½®è‡ªå·±çš„çº¿ç¨‹ç»ˆæ­¢æ ‡å¿—ä½</strong>ï¼Œä¾‹å¦‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨isTerminatedä½œä¸ºçº¿ç¨‹ç»ˆæ­¢æ ‡å¿—ä½ï¼Œæ­¤æ—¶æ— è®ºæ˜¯å¦æ­£ç¡®å¤„ç†äº†çº¿ç¨‹çš„ä¸­æ–­å¼‚å¸¸ï¼Œéƒ½ä¸ä¼šå½±å“çº¿ç¨‹ä¼˜é›…åœ°ç»ˆæ­¢ã€‚</p><pre><code>class Proxy {
  //çº¿ç¨‹ç»ˆæ­¢æ ‡å¿—ä½
  volatile boolean terminated = false;
  boolean started = false;
  //é‡‡é›†çº¿ç¨‹
  Thread rptThread;
  //å¯åŠ¨é‡‡é›†åŠŸèƒ½
  synchronized void start(){
    //ä¸å…è®¸åŒæ—¶å¯åŠ¨å¤šä¸ªé‡‡é›†çº¿ç¨‹
    if (started) {
      return;
    }
    started = true;
    terminated = false;
    rptThread = new Thread(()-&gt;{
      while (!terminated){
        //çœç•¥é‡‡é›†ã€å›ä¼ å®ç°
        report();
        //æ¯éš”ä¸¤ç§’é’Ÿé‡‡é›†ã€å›ä¼ ä¸€æ¬¡æ•°æ®
        try {
          Thread.sleep(2000);
        } catch (InterruptedException e){
          //é‡æ–°è®¾ç½®çº¿ç¨‹ä¸­æ–­çŠ¶æ€
          Thread.currentThread().interrupt();
        }
      }
      //æ‰§è¡Œåˆ°æ­¤å¤„è¯´æ˜çº¿ç¨‹é©¬ä¸Šç»ˆæ­¢
      started = false;
    });
    rptThread.start();
  }
  //ç»ˆæ­¢é‡‡é›†åŠŸèƒ½
  synchronized void stop(){
    //è®¾ç½®ä¸­æ–­æ ‡å¿—ä½
    terminated = true;
    //ä¸­æ–­çº¿ç¨‹rptThread
    rptThread.interrupt();
  }
}
</code></pre><h2>å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹æ± </h2><p>Javaé¢†åŸŸç”¨çš„æœ€å¤šçš„è¿˜æ˜¯çº¿ç¨‹æ± ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨åœ°åˆ›å»ºçº¿ç¨‹ã€‚é‚£æˆ‘ä»¬è¯¥å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹æ± å‘¢ï¼Ÿ</p><p>çº¿ç¨‹æ± æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼š<strong>shutdown()<strong>å’Œ</strong>shutdownNow()</strong>ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿè¦äº†è§£å®ƒä»¬çš„åŒºåˆ«ï¼Œå°±å…ˆéœ€è¦äº†è§£çº¿ç¨‹æ± çš„å®ç°åŸç†ã€‚</p><p>æˆ‘ä»¬æ›¾ç»è®²è¿‡ï¼ŒJavaçº¿ç¨‹æ± æ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„ä¸€ç§å®ç°ï¼Œæäº¤ç»™çº¿ç¨‹æ± çš„ä»»åŠ¡ï¼Œé¦–å…ˆæ˜¯è¿›å…¥ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ä¸­ï¼Œä¹‹åçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ‰§è¡Œã€‚</p><p>shutdown()æ–¹æ³•æ˜¯ä¸€ç§å¾ˆä¿å®ˆçš„å…³é—­çº¿ç¨‹æ± çš„æ–¹æ³•ã€‚çº¿ç¨‹æ± æ‰§è¡Œshutdown()åï¼Œå°±ä¼šæ‹’ç»æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Œä½†æ˜¯ä¼šç­‰å¾…çº¿ç¨‹æ± ä¸­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å’Œå·²ç»è¿›å…¥é˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œä¹‹åæ‰æœ€ç»ˆå…³é—­çº¿ç¨‹æ± ã€‚</p><p>è€ŒshutdownNow()æ–¹æ³•ï¼Œç›¸å¯¹å°±æ¿€è¿›ä¸€äº›äº†ï¼Œçº¿ç¨‹æ± æ‰§è¡ŒshutdownNow()åï¼Œä¼šæ‹’ç»æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼ŒåŒæ—¶è¿˜ä¼šä¸­æ–­çº¿ç¨‹æ± ä¸­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå·²ç»è¿›å…¥é˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡ä¹Ÿè¢«å‰¥å¤ºäº†æ‰§è¡Œçš„æœºä¼šï¼Œä¸è¿‡è¿™äº›è¢«å‰¥å¤ºæ‰§è¡Œæœºä¼šçš„ä»»åŠ¡ä¼šä½œä¸ºshutdownNow()æ–¹æ³•çš„è¿”å›å€¼è¿”å›ã€‚å› ä¸ºshutdownNow()æ–¹æ³•ä¼šä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œæ‰€ä»¥æäº¤åˆ°çº¿ç¨‹æ± çš„ä»»åŠ¡ï¼Œå¦‚æœéœ€è¦ä¼˜é›…åœ°ç»“æŸï¼Œå°±éœ€è¦æ­£ç¡®åœ°å¤„ç†çº¿ç¨‹ä¸­æ–­ã€‚</p><p>å¦‚æœæäº¤åˆ°çº¿ç¨‹æ± çš„ä»»åŠ¡ä¸å…è®¸å–æ¶ˆï¼Œé‚£å°±ä¸èƒ½ä½¿ç”¨shutdownNow()æ–¹æ³•ç»ˆæ­¢çº¿ç¨‹æ± ã€‚ä¸è¿‡ï¼Œå¦‚æœæäº¤åˆ°çº¿ç¨‹æ± çš„ä»»åŠ¡å…è®¸åç»­ä»¥è¡¥å¿çš„æ–¹å¼é‡æ–°æ‰§è¡Œï¼Œä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨shutdownNow()æ–¹æ³•ç»ˆæ­¢çº¿ç¨‹æ± çš„ã€‚<a href="time://mall?url=https%3A%2F%2Fh5.youzan.com%2Fv2%2Fgoods%2F2758xqdzr6uuw">ã€ŠJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹</a>è¿™æœ¬ä¹¦ç¬¬7ç« ã€Šå–æ¶ˆä¸å…³é—­ã€‹çš„â€œshutdownNowçš„å±€é™æ€§â€ä¸€èŠ‚ä¸­ï¼Œæåˆ°ä¸€ç§å°†å·²æäº¤ä½†å°šæœªå¼€å§‹æ‰§è¡Œçš„ä»»åŠ¡ä»¥åŠå·²ç»å–æ¶ˆçš„æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ä¿å­˜èµ·æ¥ï¼Œä»¥ä¾¿åç»­é‡æ–°æ‰§è¡Œçš„æ–¹æ¡ˆï¼Œä½ å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼Œæ–¹æ¡ˆå¾ˆç®€ç­”ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚</p><p>å…¶å®åˆ†æå®Œshutdown()å’ŒshutdownNow()æ–¹æ³•ä½ ä¼šå‘ç°ï¼Œå®ƒä»¬å®è´¨ä¸Šä½¿ç”¨çš„ä¹Ÿæ˜¯ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼Œåªæ˜¯ç»ˆæ­¢æŒ‡ä»¤çš„èŒƒå›´ä¸åŒè€Œå·²ï¼Œå‰è€…åªå½±å“é˜»å¡é˜Ÿåˆ—æ¥æ”¶ä»»åŠ¡ï¼Œåè€…èŒƒå›´æ‰©å¤§åˆ°çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„ä»»åŠ¡ã€‚</p><h2>æ€»ç»“</h2><p>ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼æ˜¯ä¸€ç§åº”ç”¨å¾ˆå¹¿æ³›çš„å¹¶å‘è®¾è®¡æ¨¡å¼ï¼Œåœ¨Javaè¯­è¨€ä¸­ä½¿ç”¨ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼æ¥ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹ï¼Œéœ€è¦æ³¨æ„ä¸¤ä¸ªå…³é”®ç‚¹ï¼šä¸€ä¸ªæ˜¯ä»…æ£€æŸ¥ç»ˆæ­¢æ ‡å¿—ä½æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºçº¿ç¨‹çš„çŠ¶æ€å¯èƒ½å¤„äºä¼‘çœ æ€ï¼›å¦ä¸€ä¸ªæ˜¯ä»…æ£€æŸ¥çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä¹Ÿæ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¾èµ–çš„ç¬¬ä¸‰æ–¹ç±»åº“å¾ˆå¯èƒ½æ²¡æœ‰æ­£ç¡®å¤„ç†ä¸­æ–­å¼‚å¸¸ã€‚</p><p>å½“ä½ ä½¿ç”¨Javaçš„çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹çš„æ—¶å€™ï¼Œéœ€è¦ä¾èµ–çº¿ç¨‹æ± æä¾›çš„shutdown()å’ŒshutdownNow()æ–¹æ³•æ¥ç»ˆæ­¢çº¿ç¨‹æ± ã€‚ä¸è¿‡åœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„å®ƒä»¬çš„åº”ç”¨åœºæ™¯ï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨shutdownNow()çš„æ—¶å€™ï¼Œä¸€å®šè¦è°¨æ…ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>æœ¬æ–‡çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œçº¿ç¨‹ç»ˆæ­¢æ ‡å¿—ä½isTerminatedè¢«å£°æ˜ä¸ºvolatileï¼Œä½ è§‰å¾—æ˜¯å¦æœ‰å¿…è¦å‘¢ï¼Ÿ</p><pre><code>class Proxy {
  //çº¿ç¨‹ç»ˆæ­¢æ ‡å¿—ä½
  volatile boolean terminated = false;
  ......
}
</code></pre><p>æ¬¢è¿åœ¨ç•™è¨€åŒºä¸æˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè®°å½•ä½ çš„æ€è€ƒè¿‡ç¨‹ã€‚æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/cf/aa/cf393cd748a4f0e6451807c4b61843aa.jpg" alt=""></p><h2>ç²¾é€‰ç•™è¨€ï¼š</h2>
        <ul>
        
<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å­™å¿—å¼º  2019-05-18 09:37:06
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æœ‰å¿…è¦ï¼Œå˜é‡è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œéœ€è¦ä¿è¯å¯è§æ€§ [4èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-05-18 16:30:51</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ğŸ‘</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ZOUå¿—ä¼Ÿ  2019-05-18 17:14:26
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            shutdown()è°ƒç”¨åï¼Œè¿˜è¦å†è°ƒç”¨awaitTerminationæ–¹æ³•ç­‰å¾…ä¸€ç‚¹æ—¶é—´ï¼Œçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ‰ä¼šç»ˆæ­¢ã€‚ [2èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            æ™“æ°  2019-05-19 14:02:06
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æœ‰å¿…è¦ï¼Œå› ä¸ºstopæ–¹æ³•å¯¹isTerminatedçš„ä¿®æ”¹éœ€è¦è¢«startæ–¹æ³•è¯»å–åˆ°ï¼Œä¿è¯å…±äº«å˜é‡çš„å¯è§æ€§ [1èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            WL  2019-05-20 20:27:52
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆè¯·é—®ä¸€ä¸‹å¯¹&quot;æ²¡æœ‰åŠæ³•ä¿è¯ç¬¬ä¸‰æ–¹ç±»åº“æ­£ç¡®å¤„ç†äº†çº¿ç¨‹çš„ä¸­æ–­å¼‚å¸¸&quot;è¿™å¥è¯æˆ‘ä¸æ˜¯å¾ˆç†è§£,  ä¾‹å­ä¸­çš„sleepæ–¹æ³•ä¸æ˜¯åœ¨æœ¬åœ°æ‰§è¡Œçš„å—, ä¸ºä»€ä¹ˆä¼šè·Ÿç¬¬ä¸‰æ–¹ç±»åº“æœ‰å…³ç³» ? 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-05-20 21:10:36</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">å®é™…åœºæ™¯éƒ½ä¸ä¼šè¿™ä¹ˆç®€å•</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            WL  2019-05-20 20:21:02
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è¯·é—®ä¸€ä¸‹è€å¸ˆ&quot;JVM çš„å¼‚å¸¸å¤„ç†ä¼šæ¸…é™¤çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€&quot;æŒ‡çš„æ˜¯ä»€ä¹ˆæ„æ€, æ˜¯æŒ‡æŠŠçº¿ç¨‹çš„ä¸ºtrueçš„ä¸­æ–­çŠ¶æ€æ”¹ä¸ºfalseå—, JVMæ˜¯åœ¨catchåˆ°Interruptå¼‚å¸¸çš„æ—¶å€™é‡ç½®çº¿ç¨‹ä¸­æ–­çŠ¶æ€çš„å—?  
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-05-20 21:11:23</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ˜¯çš„</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ä½‘å„¿  2019-05-20 18:28:11
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼šå‘é€ç»ˆæ­¢æŒ‡ä»¤+å“åº”ç»ˆæ­¢æŒ‡ä»¤ã€‚<br>ç»ˆæ­¢æŒ‡ä»¤é€šå¸¸å¯ä»¥å®šä¹‰ä¸€ä¸ªç»ˆæ­¢æ ‡è¯†å˜é‡(æ³¨æ„å¹¶å‘é—®é¢˜,éœ€è¦volatieä¿è¯å¯è§æ€§)ã€‚<br>å¦‚æœçº¿ç¨‹ä¸­è°ƒç”¨äº†å¯ä¸­æ–­æ–¹æ³•(waitç­‰)ï¼Œåœ¨å‘é€ç»ˆæ­¢æŒ‡ä»¤çš„åŒæ—¶éœ€è¦è°ƒç”¨Thread.interrupt()ã€‚<br>ä¸å»ºè®®ä½¿ç”¨çº¿ç¨‹è‡ªèº«çš„ä¸­æ–­æ ‡è¯†ä½œä¸ºç»ˆæ­¢æŒ‡ä»¤ï¼Œå› ä¸ºé¡¹ç›®ä¸­ç¬¬ä¸‰æ–¹çš„è°ƒç”¨æ— æ³•ä¿è¯è¯¥æ ‡å¿—ä½ã€‚ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ä½‘å„¿  2019-05-20 17:56:59
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            stopå’Œstartæ–¹æ³•å¯¹äºterminatedè®¿é—®ç”±äºsynå…³é”®å­—ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯startä¸­æ–°èµ·äº†ä¸€ä¸ªçº¿ç¨‹rptthreadï¼Œå¯¼è‡´stopæ–¹æ³•ä¸­å¯¹äºterminatedå­˜åœ¨å¯è§æ€§é—®é¢˜ï¼Œå› æ­¤éœ€è¦volatieï¼ŒåŸå­æ€§é—®é¢˜å¯¹è¿™ä¸ªä»£ç æ®µæ²¡æœ‰å½±å“ï¼Œæ‰€ä»¥åŸå­æ€§é—®é¢˜æ— éœ€å…³æ³¨ã€‚ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-05-20 21:12:18</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ğŸ‘</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            åŒ…å­  2019-05-20 10:15:31
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆä½ å¥½ï¼Œ<br>ä¼˜é›…å…³é—­çº¿ç¨‹æœ€åä¸€ä¸ªæ¡ˆä¾‹ä»£ç ä½¿ç”¨terminatedä½œä¸ºçº¿ç¨‹ä¸­æ–­çš„æ ‡å¿—ä½ï¼Œé‚£cacheä½sleepæ—¶ï¼Œä¸ç”¨è®¾ç½®terminatedä¸ºtrueå—ã€‚ä¸è®¾ç½®çº¿ç¨‹æ˜¯å…³é—­ä¸äº†çš„å•Šã€‚<br>        try {<br>          Thread.sleep(2000);<br>        } catch (InterruptedException e){<br>          &#47;&#47; é‡æ–°è®¾ç½®çº¿ç¨‹ä¸­æ–­çŠ¶æ€<br>          Thread.currentThread().interrupt();<br>        }<br><br> 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-05-20 21:14:03</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">stopæ–¹æ³•é‡Œè®¾ç½®è¿‡äº†</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Liam  2019-05-20 08:21:51
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æ‰€ä»¥ä¼˜é›…åœæ­¢çº¿ç¨‹çš„å…³é”®åœ¨äºå¦‚ä½•ä¼˜é›…åœ°å¤„ç†ä¸­æ–­ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ææœªæ¥  2019-05-20 07:43:47
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æœ‰å¿…è¦ï¼Œä¿æŒå¯è§æ€§. 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ææ—æ°  2019-05-19 22:41:58
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆï¼Œstartedæ˜¯å¦éœ€è¦åŠ voliatleä¿è¯ï¼Œå¤šä¸ªçº¿ç¨‹çœ‹åˆ°çš„éƒ½æ˜¯æœ€æ–°çš„å€¼ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-05-20 08:45:46</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">synchronized å°±ä¸éœ€è¦äº†</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            é‡è§é˜³å…‰  2019-05-18 23:25:59
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æŒ‰é“ç†è€Œè¨€ï¼Œsynchronizedä¿è¯åŸå­æ€§çš„åŒæ—¶ï¼Œä¹Ÿèƒ½é—´æ¥çš„ä¿è¯å¯è§æ€§å•Šã€‚æ„Ÿè§‰å¯ä»¥ä¸åŠ  volatileå…³é”®å­— 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-05-20 09:03:31</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">é—®é¢˜æ˜¯startæ–¹æ³•é‡Œåˆå¯åŠ¨äº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œsynchronizedç®¡ä¸åˆ°è¿™ä¸ªæ–°çš„çº¿ç¨‹</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å…”æ–¯åŸº  2019-05-18 15:31:46
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æœ‰å¿…è¦ï¼Œé¡¹ç›®ä¸­å°±æ˜¯è¿™ä¹ˆè®¾ç½®çš„ï¼Œè¸©è¿‡ä¸€æ¬¡äº†å‘äº† 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ZOUå¿—ä¼Ÿ  2019-05-18 12:08:46
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æœ‰å¿…è¦ï¼Œstop()æ–¹æ³•æ‰§è¡Œåï¼Œè¯»terminatedçš„start()æ–¹æ³•è¦å†æ¬¡æ‰§è¡Œæ‰ä¼šå¯è§ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-05-18 16:30:24</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ğŸ‘</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ack  2019-05-18 10:23:12
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æœ‰å¿…è¦ï¼Œå‡è®¾ä¸åŠ volatileï¼Œ é‚£ä¹ˆåœ¨while (!terminated)æ—¶è¯»terminatedçš„å€¼å¯èƒ½ä¼šåœ¨stop()æ–¹æ³•ä¸­å†™terminatedå€¼ä¹‹å‰ï¼Œå¹¶ä¸”stop()æ–¹æ³•æ‰§è¡Œçš„çº¿ç¨‹Aå’Œåœ¨whileå¾ªç¯çš„çº¿ç¨‹Bæ˜¯ä¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´éƒ½æœ‰è‡ªå·±å˜é‡å‰¯æœ¬ï¼ŒAçº¿ç¨‹åœ¨è‡ªå·±ç¼“å­˜è®¾ç½®å€¼åä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™æ‰å†™å›å†…å­˜ï¼Œå¯èƒ½å¯¼è‡´ä¸­æ–­å»¶è¿Ÿã€‚ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å—åŒ—å°‘å¿  2019-05-18 10:17:46
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            start() å’Œstop()éƒ½æ˜¯ä½¿ç”¨çš„åŒä¸€æŠŠé”thisï¼Œè¿™æ ·çš„è¯ï¼Œæ²¡å¿…è¦å†ç”¨volatileå£°æ˜isTerminatedäº†å§<br> 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-05-18 16:29:13</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æœ‰å¿…è¦</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            zero  2019-05-18 09:09:54
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æ˜¯æœ‰å¿…è¦çš„ï¼Œä¿è¯å¯è§æ€§ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            é”¦  2019-05-18 08:48:43
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æ‰“å¡ï¼Œæœ‰å¿…è¦ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            echoï¼¿é™ˆ  2019-05-18 08:37:22
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æˆ‘è§‰å¾—ï¼Œåœ¨æœ¬ä¾‹å­ä¸­ã€‚stopä¸­ï¼Œè®¾ç½®ç»ˆæ­¢æ ‡è¯†ä½å¯¹interuptæ˜¯å¯è§çš„ã€‚è€Œinterruptå¯¹è¢«ä¸­æ–­çº¿ç¨‹æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶æ˜¯å¯è§çš„â€¦â€¦æ ¹æ®ä¼ é€’æ€§åŸåˆ™â€¦â€¦æˆ‘è§‰å¾—æœ¬ä¾‹å­ä¸éœ€è¦volatileå…³é”®å­—ã€‚ä½†å¹³æ—¶å¼€å‘ä¸­ï¼Œä¸€èˆ¬ä¼šåŠ ä¸Šï¼Œä¸»è¦æ˜¯å› ä¸ºæ€•åç»­å¼€å‘ä¸æ³¨æ„è¿™äº›äº‹æƒ…å¯¼è‡´ä¿®æ”¹ç ´åäº†è§„åˆ™ï¼Œå¼•èµ·å¯è§æ€§é—®é¢˜äº§ç”Ÿbugï¼Œä¿é™©èµ·è§ä¼šåŠ ä¸Švolatile 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-05-18 16:42:35</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ˜¯çš„ï¼Œçº¿ç¨‹ä¸è°ƒç”¨wait,sleepç­‰æ–¹æ³•ï¼Œæ˜¯æ— æ³•å“åº”ä¸­æ–­çš„ï¼Œè¿™ä¸ªæ—¶å€™åŸºäºinterruptçš„å¯è§æ€§å°±ä¸æˆç«‹äº†ï¼Œæ‰€ä»¥å·¥ç¨‹ä¸Šè¿™ç±»å˜é‡éƒ½éœ€è¦åŠ volatile</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Corner  2019-05-18 07:18:26
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            å¤šçº¿ç¨‹è¯»å†™å…±äº«å˜é‡ï¼Œä¿è¯å¯è§æ€§ä½¿ç”¨volitaleæ²¡æ¯›ç—… 
        </div>
        
    </div>
</li>
            </ul>
</div>
</body>
</html>